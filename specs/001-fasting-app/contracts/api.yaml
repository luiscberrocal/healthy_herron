openapi: 3.0.3
info:
  title: Fasting Tracker API
  description: API for tracking personal fasting periods with emotional status
  version: 1.0.0
  contact:
    name: Healthy Herron API
    
servers:
  - url: /api/v1
    description: API v1 endpoint

security:
  - sessionAuth: []
  - tokenAuth: []

paths:
  /fasting/fasts/:
    get:
      summary: List user's fasting records
      description: Retrieve paginated list of fasting records for authenticated user, ordered by most recent first
      tags:
        - Fasting
      parameters:
        - name: page
          in: query
          description: Page number for pagination
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: page_size
          in: query
          description: Number of records per page
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
        - name: status
          in: query
          description: Filter by fast status
          schema:
            type: string
            enum: [active, completed]
      responses:
        '200':
          description: Successful response with paginated fasting records
          content:
            application/json:
              schema:
                type: object
                properties:
                  count:
                    type: integer
                    description: Total number of records
                  next:
                    type: string
                    format: uri
                    nullable: true
                    description: URL to next page
                  previous:
                    type: string
                    format: uri
                    nullable: true
                    description: URL to previous page
                  results:
                    type: array
                    items:
                      $ref: '#/components/schemas/Fast'
        '401':
          $ref: '#/components/responses/Unauthorized'

    post:
      summary: Start a new fast
      description: Create a new fasting record with current timestamp
      tags:
        - Fasting
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                start_time:
                  type: string
                  format: date-time
                  description: Fast start time (defaults to current time if not provided)
              example:
                start_time: "2025-10-25T08:00:00Z"
      responses:
        '201':
          description: Fast started successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Fast'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /fasting/fasts/{id}/:
    get:
      summary: Get fast details
      description: Retrieve detailed information about a specific fast
      tags:
        - Fasting
      parameters:
        - name: id
          in: path
          required: true
          description: Fast ID
          schema:
            type: integer
      responses:
        '200':
          description: Fast details retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FastDetail'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

    patch:
      summary: Update fast details
      description: Update emotional status, comments, or times for an existing fast
      tags:
        - Fasting
      parameters:
        - name: id
          in: path
          required: true
          description: Fast ID
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                end_time:
                  type: string
                  format: date-time
                  description: Fast end time
                emotional_status:
                  type: string
                  enum: [energized, satisfied, challenging, difficult]
                  description: User's emotional state when ending fast
                comments:
                  type: string
                  maxLength: 128
                  description: User's reflection on the fast
                start_time:
                  type: string
                  format: date-time
                  description: Fast start time (for corrections)
              example:
                end_time: "2025-10-25T16:00:00Z"
                emotional_status: "satisfied"
                comments: "Felt great today, good energy levels"
      responses:
        '200':
          description: Fast updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FastDetail'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

    delete:
      summary: Delete fast record
      description: Permanently delete a fast record
      tags:
        - Fasting
      parameters:
        - name: id
          in: path
          required: true
          description: Fast ID
          schema:
            type: integer
      responses:
        '204':
          description: Fast deleted successfully
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  /fasting/fasts/{id}/end/:
    post:
      summary: End an active fast
      description: Complete an active fast by setting end time and emotional status
      tags:
        - Fasting
      parameters:
        - name: id
          in: path
          required: true
          description: Fast ID
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - emotional_status
              properties:
                end_time:
                  type: string
                  format: date-time
                  description: Fast end time (defaults to current time if not provided)
                emotional_status:
                  type: string
                  enum: [energized, satisfied, challenging, difficult]
                  description: User's emotional state when ending fast
                comments:
                  type: string
                  maxLength: 128
                  description: User's reflection on the fast
              example:
                emotional_status: "energized"
                comments: "Excellent fast, felt very focused"
      responses:
        '200':
          description: Fast ended successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FastDetail'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

components:
  securitySchemes:
    sessionAuth:
      type: apiKey
      in: cookie
      name: sessionid
    tokenAuth:
      type: http
      scheme: bearer

  schemas:
    Fast:
      type: object
      properties:
        id:
          type: integer
          readOnly: true
        start_time:
          type: string
          format: date-time
          description: When the fast began
        end_time:
          type: string
          format: date-time
          nullable: true
          description: When the fast ended (null for active fasts)
        emotional_status:
          type: string
          enum: [energized, satisfied, challenging, difficult]
          nullable: true
          description: User's emotional state when ending fast
        comments:
          type: string
          maxLength: 128
          description: User's reflection on the fast
        is_active:
          type: boolean
          readOnly: true
          description: Whether the fast is currently ongoing
        duration_hours:
          type: string
          readOnly: true
          nullable: true
          description: Human-readable duration for completed fasts
        elapsed_hours:
          type: string
          readOnly: true
          description: Human-readable elapsed time from start
        created:
          type: string
          format: date-time
          readOnly: true
        modified:
          type: string
          format: date-time
          readOnly: true
      required:
        - start_time
      example:
        id: 1
        start_time: "2025-10-25T08:00:00Z"
        end_time: "2025-10-25T16:00:00Z"
        emotional_status: "satisfied"
        comments: "Great fast today"
        is_active: false
        duration_hours: "8 hours"
        elapsed_hours: "8 hours"
        created: "2025-10-25T08:00:00Z"
        modified: "2025-10-25T16:00:15Z"

    FastDetail:
      allOf:
        - $ref: '#/components/schemas/Fast'
        - type: object
          properties:
            duration:
              type: string
              readOnly: true
              nullable: true
              description: ISO 8601 duration for completed fasts
            user:
              type: object
              readOnly: true
              properties:
                id:
                  type: integer
                username:
                  type: string
              description: Fast owner information

    Error:
      type: object
      properties:
        detail:
          type: string
          description: Error message
        code:
          type: string
          description: Error code
      required:
        - detail

    ValidationError:
      type: object
      properties:
        field_errors:
          type: object
          additionalProperties:
            type: array
            items:
              type: string
        non_field_errors:
          type: array
          items:
            type: string
      example:
        field_errors:
          emotional_status: ["This field is required when ending a fast."]
        non_field_errors: ["End time must be after start time."]

  responses:
    BadRequest:
      description: Bad request - validation errors
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ValidationError'

    Unauthorized:
      description: Authentication required
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            detail: "Authentication credentials were not provided."

    Forbidden:
      description: Access denied - insufficient permissions
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            detail: "You do not have permission to access this fast record."

    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            detail: "Fast record not found."

tags:
  - name: Fasting
    description: Fasting period tracking operations